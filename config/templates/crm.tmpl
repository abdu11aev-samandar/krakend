
{{define "ApiEndpoint"}}

{{$default_host :=index . 0}}
{{$service:= index . 1}}

{{ $levels := list "{level1}" "{level2}" "{level3}" "{level4}"}}

{{range $i, $level := $levels}}
{
 "endpoint": "/{{$service}}/api/v1{{range $j := until (int (add $i 1))}}/{{index $levels (int $j)}}{{end}}",
 "extra_config": {
    {{ include "rate_limit_backend.tmpl"}}
 },
 "output_encoding": "no-op",
 {{ include "input_headers.tmpl"}},
 {{ include "input_queries.tmpl"}},
 "backend": [
     {
         "url_pattern": "/api/v1{{range $j := until (int (add $i 1))}}/{{index $levels (int $j)}}{{end}}",
         "encoding": "no-op",
         "sd": "static",
         "extra_config": {},
         "host": ["{{ $default_host }}"],
         "disable_host_sanitize": true
     }
 ]
}{{if lt (int $i) (int (sub (len $levels) 1))}},{{end}}
{{end}}

{{end}}

